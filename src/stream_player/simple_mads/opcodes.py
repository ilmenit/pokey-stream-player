"""6502 opcode table and addressing mode definitions."""

# Addressing mode sizes (bytes including opcode)
MODE_SIZE = {
    'imp': 1, 'acc': 1, 'imm': 2, 'rel': 2,
    'zp': 2, 'zpx': 2, 'zpy': 2,
    'abs': 3, 'abx': 3, 'aby': 3,
    'ind': 3, 'izx': 2, 'izy': 2,
}

# {(mnemonic, mode): opcode_byte}
OPCODES = {}

def _r(mnem, **modes):
    for mode, op in modes.items():
        if mode == 'abs_':
            mode = 'abs'
        OPCODES[(mnem, mode)] = op

# Load / Store
_r('lda', imm=0xA9, zp=0xA5, zpx=0xB5, abs_=0xAD, abx=0xBD, aby=0xB9, izx=0xA1, izy=0xB1)
_r('ldx', imm=0xA2, zp=0xA6, zpy=0xB6, abs_=0xAE, aby=0xBE)
_r('ldy', imm=0xA0, zp=0xA4, zpx=0xB4, abs_=0xAC, abx=0xBC)
_r('sta', zp=0x85, zpx=0x95, abs_=0x8D, abx=0x9D, aby=0x99, izx=0x81, izy=0x91)
_r('stx', zp=0x86, zpy=0x96, abs_=0x8E)
_r('sty', zp=0x84, zpx=0x94, abs_=0x8C)

# Arithmetic / Logic
_r('adc', imm=0x69, zp=0x65, zpx=0x75, abs_=0x6D, abx=0x7D, aby=0x79, izx=0x61, izy=0x71)
_r('sbc', imm=0xE9, zp=0xE5, zpx=0xF5, abs_=0xED, abx=0xFD, aby=0xF9, izx=0xE1, izy=0xF1)
_r('and', imm=0x29, zp=0x25, zpx=0x35, abs_=0x2D, abx=0x3D, aby=0x39, izx=0x21, izy=0x31)
_r('ora', imm=0x09, zp=0x05, zpx=0x15, abs_=0x0D, abx=0x1D, aby=0x19, izx=0x01, izy=0x11)
_r('eor', imm=0x49, zp=0x45, zpx=0x55, abs_=0x4D, abx=0x5D, aby=0x59, izx=0x41, izy=0x51)
_r('cmp', imm=0xC9, zp=0xC5, zpx=0xD5, abs_=0xCD, abx=0xDD, aby=0xD9, izx=0xC1, izy=0xD1)
_r('cpx', imm=0xE0, zp=0xE4, abs_=0xEC)
_r('cpy', imm=0xC0, zp=0xC4, abs_=0xCC)

# Shifts / Rotates
_r('asl', acc=0x0A, zp=0x06, zpx=0x16, abs_=0x0E, abx=0x1E)
_r('lsr', acc=0x4A, zp=0x46, zpx=0x56, abs_=0x4E, abx=0x5E)
_r('rol', acc=0x2A, zp=0x26, zpx=0x36, abs_=0x2E, abx=0x3E)
_r('ror', acc=0x6A, zp=0x66, zpx=0x76, abs_=0x6E, abx=0x7E)

# Inc / Dec
_r('inc', zp=0xE6, zpx=0xF6, abs_=0xEE, abx=0xFE)
_r('dec', zp=0xC6, zpx=0xD6, abs_=0xCE, abx=0xDE)

# Bit test
_r('bit', zp=0x24, abs_=0x2C)

# Jumps / Calls
_r('jmp', abs_=0x4C, ind=0x6C)
_r('jsr', abs_=0x20)

# Branches (all relative)
_r('bcc', rel=0x90); _r('bcs', rel=0xB0)
_r('beq', rel=0xF0); _r('bne', rel=0xD0)
_r('bmi', rel=0x30); _r('bpl', rel=0x10)
_r('bvc', rel=0x50); _r('bvs', rel=0x70)

# Implied
_r('brk', imp=0x00); _r('nop', imp=0xEA)
_r('rti', imp=0x40); _r('rts', imp=0x60)
_r('clc', imp=0x18); _r('sec', imp=0x38)
_r('cli', imp=0x58); _r('sei', imp=0x78)
_r('cld', imp=0xD8); _r('sed', imp=0xF8)
_r('clv', imp=0xB8)
_r('tax', imp=0xAA); _r('tay', imp=0xA8)
_r('txa', imp=0x8A); _r('tya', imp=0x98)
_r('tsx', imp=0xBA); _r('txs', imp=0x9A)
_r('inx', imp=0xE8); _r('iny', imp=0xC8)
_r('dex', imp=0xCA); _r('dey', imp=0x88)
_r('pha', imp=0x48); _r('pla', imp=0x68)
_r('php', imp=0x08); _r('plp', imp=0x28)

BRANCHES = {'bcc','bcs','beq','bne','bmi','bpl','bvc','bvs'}
SHIFT_OPS = {'asl','lsr','rol','ror'}
ALL_MNEMONICS = {m for m, _ in OPCODES}
